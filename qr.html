<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X5-MD â€¢ QR Code</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Inter',sans-serif;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#e6f0ff 0%,#ffffff 100%);
}

/* WRAPPER */
.wrapper{
  width:100%;
  max-width:440px;
  padding:20px;
}

/* CARD */
.card{
  background:#fff;
  border-radius:24px;
  padding:40px 30px;
  text-align:center;
  box-shadow:0 30px 70px rgba(0,0,0,0.08);
}

/* LOGO */
.logo{
  width:95px;
  height:95px;
  border-radius:22px;
  object-fit:cover;
  margin-bottom:20px;
  box-shadow:0 12px 30px rgba(0,0,0,0.12);
}

/* TEXT */
h1{
  font-size:26px;
  font-weight:700;
  margin-bottom:6px;
}

.subtitle{
  font-size:14px;
  color:#6b7280;
  margin-bottom:25px;
}

/* QR IMAGE */
.qr-frame{
  background:#fff;
  padding:16px;
  border-radius:20px;
  box-shadow:0 15px 30px rgba(0,0,0,0.08);
  margin-bottom:20px;
}

#qrImage{
  width:250px;
  height:250px;
  border-radius:12px;
}

/* STATUS TEXT */
.status-text{
  font-size:13px;
  color:#1e88e5;
  font-weight:600;
  margin-bottom:20px;
}

/* STEPS */
.steps{
  text-align:left;
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.step{
  display:flex;
  align-items:flex-start;
  gap:10px;
  padding:10px;
  background:#f3f4f6;
  border-radius:12px;
}

.step-num{
  font-weight:700;
  color:#0072ff;
  flex-shrink:0;
}

.step-text{
  font-size:14px;
  color:#4b5563;
}

/* ERROR */
.error-area{
  display:none;
  margin-top:15px;
}

.error-text{
  color:red;
  font-weight:600;
  margin-bottom:10px;
}

.retry-btn{
  padding:12px;
  width:100%;
  border:none;
  border-radius:12px;
  background:#0072ff;
  color:#fff;
  cursor:pointer;
  font-weight:600;
  transition:.25s;
}

.retry-btn:hover{
  background:#005bb5;
}

/* LOADER */
.loader{
  position:fixed;
  inset:0;
  background:white;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:999;
  display:none;
}

.loader img{
  width:120px;
  border-radius:20px;
  margin-bottom:20px;
  animation:pulse 1.5s infinite;
}

@keyframes pulse{
  0%{transform:scale(1);opacity:1}
  50%{transform:scale(1.05);opacity:.7}
  100%{transform:scale(1);opacity:1}
}
</style>
</head>
<body>

<div class="wrapper">
  <div class="card">

    <img src="https://linksharing.samsungcloud.com/fzNXbdWhVZXy" class="logo">

    <h1>X5-MD QR Code</h1>
    <div class="subtitle">Scan this QR code with WhatsApp to connect</div>

    <!-- QR FRAME -->
    <div class="qr-frame" id="qr-area">
      <img id="qrImage" src="" alt="WhatsApp QR Code">
    </div>

    <div class="status-text" id="status"></div>

    <!-- STEPS -->
    <div class="steps" id="steps"></div>

    <!-- ERROR -->
    <div class="error-area" id="error-area">
      <div class="error-text" id="error-msg">Failed to load QR code</div>
      <button class="retry-btn" onclick="loadQRCode()">Retry</button>
    </div>

  </div>
</div>

<!-- LOADER -->
<div class="loader" id="loader">
  <img src="https://linksharing.samsungcloud.com/fzNXbdWhVZXy">
  <div>Generating your QR code...</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
<script>
async function loadQRCode() {
  const loader = document.getElementById('loader');
  const qrArea = document.getElementById('qr-area');
  const status = document.getElementById('status');
  const stepsEl = document.getElementById('steps');
  const errorArea = document.getElementById('error-area');
  const errorMsg = document.getElementById('error-msg');

  loader.style.display = 'flex';
  qrArea.style.display = 'none';
  errorArea.style.display = 'none';
  status.textContent = '';
  stepsEl.innerHTML = '';

  try {
    const res = await axios('/qr');
    const data = res.data;

    if(data.qr){
      document.getElementById('qrImage').src = data.qr;
      status.textContent = data.message || 'Scan with WhatsApp';
      
      (data.instructions || []).forEach((step,i)=>{
        const stepEl = document.createElement('div');
        stepEl.className = 'step';
        stepEl.innerHTML = `<div class="step-num">${i+1}</div><div class="step-text">${step.replace(/^\d+\.\s*/,'')}</div>`;
        stepsEl.appendChild(stepEl);
      });

      qrArea.style.display = 'block';
    } else throw new Error('No QR data');
  } catch(err){
    errorMsg.textContent = err.message || 'Failed to load QR code';
    errorArea.style.display = 'block';
  } finally {
    loader.style.display = 'none';
  }
}

loadQRCode();
</script>
</body>
</html>